<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Eventos en vivo</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap');
    :root {
      --bg: #0c0f1a;
      --panel: #131a2b;
      --border: #1f2941;
      --accent: #58d6a6;
      --muted: #94a3b8;
      --event: #7ad3ff;
      --danger: #f472b6;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 24px;
      background: radial-gradient(circle at 20% 20%, rgba(88,214,166,0.12), transparent 35%), radial-gradient(circle at 80% 0%, rgba(122,211,255,0.12), transparent 30%), var(--bg);
      color: #e2e8f0;
      font-family: 'Space Grotesk', 'Inter', system-ui, -apple-system, sans-serif;
    }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    h1 { margin: 0; font-size: 24px; letter-spacing: 0.5px; }
    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--muted);
      font-weight: 600;
      font-size: 14px;
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--muted);
      box-shadow: 0 0 0 4px rgba(88,214,166,0.08);
    }
    .status.connected { color: var(--accent); }
    .status.connected .dot { background: var(--accent); }
    .status.error { color: var(--danger); }
    .status.error .dot { background: var(--danger); box-shadow: 0 0 0 4px rgba(244,114,182,0.12); }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
    }
    .list {
      display: grid;
      gap: 12px;
      margin: 0;
      padding: 0;
      list-style: none;
      max-height: 70vh;
      overflow-y: auto;
    }
    .item {
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(19,26,43,0.7);
      display: grid;
      gap: 6px;
    }
    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--muted);
    }
    .event-name {
      color: var(--event);
      font-weight: 600;
      letter-spacing: 0.3px;
    }
    pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace;
      color: #cbd5e1;
      background: rgba(15,23,42,0.35);
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 13px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Eventos de catálogo</h1>
    <div id="status" class="status"><span class="dot"></span><span class="label">Conectando…</span></div>
  </header>
  <div class="panel">
    <ul id="log" class="list"></ul>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const statusLabel = statusEl.querySelector('.label');
    const log = document.getElementById('log');

    function setStatus(state, message) {
      statusEl.classList.remove('connected', 'error');
      statusEl.classList.add(state === 'connected' ? 'connected' : (state === 'error' ? 'error' : ''));
      statusLabel.textContent = message;
    }

    function append(eventName, payload) {
      const item = document.createElement('li');
      item.className = 'item';
      const time = new Date().toLocaleTimeString();
      const pretty = typeof payload === 'string' ? payload : JSON.stringify(payload, null, 2);
      item.innerHTML = `
        <div class="meta">
          <span class="event-name">${eventName}</span>
          <span>${time}</span>
        </div>
        <pre>${pretty}</pre>
      `;
      log.prepend(item);
      while (log.children.length > 100) {
        log.removeChild(log.lastChild);
      }
    }

    const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
    const wsUrl = `${protocol}://${window.location.host}/ws`;
    const socket = new WebSocket(wsUrl);

    socket.addEventListener('open', () => {
      setStatus('connected', 'Conectado');
    });

    socket.addEventListener('close', () => {
      setStatus('error', 'Desconectado');
    });

    socket.addEventListener('error', () => {
      setStatus('error', 'Error de conexión');
    });

    socket.addEventListener('message', (event) => {
      try {
        const data = JSON.parse(event.data);
        if (data && data.event !== undefined) {
          append(data.event, data.data ?? {});
        } else {
          append('mensaje', data);
        }
      } catch (err) {
        append('raw', event.data);
      }
    });
  </script>
</body>
</html>
